y = 0
x = 1
i = 0
j = 0
timeMax = 0
timeTotal = 0
lines = 0
exists = 0
users = []
userYear = [0, 0, 0, 0, 0]
courseCount = 0
sectionCount = 0
endpoints = []
endpointsCount = []

file = open(r"D:\timetable.log")
for line in file:
    entry = file.readline()
    entryArray = entry.split()
    
    if entryArray[3] == "GET" or entryArray[3] == "POST":

        time = float(entryArray[6][0:-3])
        if time > timeMax:
            timeMax = time                                                  #part 3
        timeTotal = time + timeTotal
        lines = lines + 1

        if entryArray[5] == "200" or entryArray[5] == "400":
            if entryArray[4] == "/courses":
                courseCount = courseCount + 1                              #part 1
                y = y + 1
            elif entryArray[4] == "/sections":
                sectionCount = sectionCount + 1
                y = y + 1

    if len(entryArray)<=4:
        continue
    else:
        ifEndpoint = list(entryArray[4])
        if ifEndpoint[0] == '/':
            j = len(endpoints)
            i = 0
            while i <= j-1:
                if str(endpoints[i]) == str(entryArray[4]):
                    endpointsCount[i] = endpointsCount[i] + 1              #part 2
                    exists = 1
                i = i + 1
            if exists == 0:
                endpoints.append(entryArray[4])
                endpointsCount.append(0)               
            exists = 0

    if entryArray[3] == "router:":
        if len(entryArray) >= 6:
            j = len(users)
            i = 0
            while i <= j-1:
                if str(users[i]) == str(entryArray[5]):               #part 4     
                    exists = 1
                i = i + 1
            if exists == 0:
                users.append(entryArray[5])
                userId = list(entryArray[5])
                userYear[int(userId[4])-1] = userYear[int(userId[4])-1] + 1

            exists = 0

    
timeAverage = timeTotal/lines
noOfUsers = len(users) 

print ("APIs Requested: ", y )
print ("")
print ("Endpoints In GET/POST")
print ("/courses: ", courseCount)
print ("/sections: ", sectionCount )
print ("")
print ("Endpoint Popularity ")
index = 0
while index < len(endpoints):
    print (endpoints[index], ": ", endpointsCount[index])                      #report
    index = index + 1
print ("")
print ( "Average Response Time: ", timeAverage)
print ("Maximum Time Taken To Respond: ", timeMax)
print ("")
print ("Total Number Of Unique IDs Who Visited The Site: ", noOfUsers)
print ("Number Of First Years: ", userYear[4])
print ("Number Of Second Years: ", userYear[3])
print ("Number Of Third Years: " , userYear[2])
print ("Number Of Fourth Years: " , userYear[1])
print ("Number Of Fifth Years: " , userYear[0])
file.close()
